---
title: "Manipulation Checks and Acceptability & Feasibility "
author: "Jackie & Mia"
date: "2025-05-14"
output: html_document
---

# Objective

To complete the Manipulation Checks as well as the Acceptability & Feasibility, we must average the scores of specific questions from each weekly survey. For the Manipulation Checks, each week has 3-4 items to average the scores from Week 1 - Week 6. For the Acceptability & Feasibility, there are 12 items to average from the Week 6 data only. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
options(knitr.duplicate.label = "allow",
        scipen = 999)

#install packages if necessary, then load libraries
if (!require(librarian)){
  install.packages("librarian")
  library(librarian)
}
librarian::shelf(
  #expss, #to make tables
  here, #to build file paths
  janitor, #for column name cleaning
  lubridate, #for working with dates 
  readxl, #read in Excel files
  stringr, #to clean data 
  tidyr, #data cleaning
  tidyverse, #general data cleaning functions and collection of common packages
  dplyr, #case_match
  writexl #save Excel files
  )
```

# Read in Survey Data
- The raw Excel data was exported from Qualtrics 
- This is the same survey data used in `rq1.Rmd`

```{r read_in_data}
#filepath & here function takes everything in green & helps R locate the correct file path
filepath <- here("../")
#"../" means one file outside of this file
print(filepath) #double check the filepath is correct
#filename function tells R where the exact file is located

filename <- list.files(path = filepath, pattern = "BQL Survey Data - CLEAN - FINAL.xlsx") #which file do we want to read in?

print(filename) #check which file we have selected
#print function means 'show me what is in this file'

#read_excel() reads in Excel files
pre_survey <- read_excel(path = here(filepath, filename[1]), sheet = 1) 
week1 <- read_excel(path = here(filepath, filename[1]), sheet = 2) 
week2 <- read_excel(path = here(filepath, filename[1]), sheet = 3)
week3 <- read_excel(path = here(filepath, filename[1]), sheet = 4)
week4 <- read_excel(path = here(filepath, filename[1]), sheet = 5)
week5 <- read_excel(path = here(filepath, filename[1]), sheet = 6)
week6 <- read_excel(path = here(filepath, filename[1]), sheet = 7)
post_survey <- read_excel(path = here(filepath, filename[1]), sheet = 8)
follow_up <- read_excel(path = here(filepath, filename[1]), sheet = 9)
```

# Clean the data 
We want to drop the "dummy" participants from pre-survey results 
- AKA we want to remove fake data based on Q1

Week 1 had no real data

Refer to BQL Survey Data - CLEAN - FINAL to see how many real participants completed each week's survey

Note that this cleaning process is identical to that used in `rq1.Rmd`

```{r}
pre_survey_clean <- pre_survey %>% 
  filter(
    Q1 == "BELL" | Q1 == "BER" | Q1 == "LAS"
  ) %>% 
  drop_na(Q4)

week2_clean <- week2 %>% 
  mutate(
    Q1 = toupper(Q1)
  ) %>% 
  filter(
    Q1 == "BELL" | Q1 == "LAS" | Q1 == "TOR"
  )

week3_clean <- week3 %>% 
  mutate(
    Q1 = toupper(Q1)
  ) %>% 
  filter(
    Q1 == "BAL" | Q1 == "LAS" | Q1 == "TOR"
  )

week4_clean <- week4 %>% 
  mutate(
    Q1 = toupper(Q1)
  ) %>% 
  filter(
    Q1 == "LAS" | Q1 == "TOR"
  )

week5_clean <- week5 %>% 
  mutate(
    Q1 = toupper(Q1)
  ) %>% 
  filter(
    Q1 == "LAS" | Q1 == "TOR"
  )

week6_clean <- week6 %>% 
  mutate(
    Q1 = toupper(Q1)
  ) %>% 
  filter(
    Q1 == "LAS"
  )

post_survey_clean <- post_survey %>% 
  mutate(
    Q1 = toupper(Q1)
  ) %>% 
  filter(
    Q1 == "LAS"
  )

follow_up_clean <- follow_up %>% 
  mutate(
    Q1 = toupper(Q1)
  ) %>% 
  filter(
    Q1 == "TOR"
  )
```

#Read in Codebook 

- This is the same Pre-Survey Codebook used in `rq1.Rmd`
- Some minimal cleaning in Excel was done to ensure all tabs have the same column names

```{r pre_codebook}
filepath <- here("../")
print(filepath) #double check the filepath is correct
filename <- list.files(path = filepath, pattern = "BQL Master Codebook.xlsx") #which file do we want to read in?
print(filename) #check which file we have selected

codebook_demographics <- read_excel(path = here(filepath, filename[1]), sheet = "Demographics") 
codebook_black <- read_excel(path = here(filepath, filename[1]), sheet = "Black Identity") 
codebook_lgbt <- read_excel(path = here(filepath, filename[1]), sheet = "LGBTQIA+ Identity Scale") 
codebook_action <- read_excel(path = here(filepath, filename[1]), sheet = "Critical Action") 
codebook_hope <- read_excel(path = here(filepath, filename[1]), sheet = "Radical Hope") 
codebook_empowerment <- read_excel(path = here(filepath, filename[1]), sheet = "Empowerment") 
codebook_anxiety <- read_excel(path = here(filepath, filename[1]), sheet = "PHQ-4 Anxiety Depression") 
codebook_ryff <- read_excel(path = here(filepath, filename[1]), sheet = "Ryff Wellbeing") 
codebook_consciousness <- read_excel(path = here(filepath, filename[1]), sheet = "Critical Consciousness")
codebook_community <- read_excel(path = here(filepath, filename[1]), sheet = "Collective Self-Esteem") 

codebook_pre <- rbind(
  codebook_demographics,
  codebook_anxiety,
  codebook_ryff,
  codebook_black,
  codebook_lgbt,
  codebook_action,
  codebook_consciousness,
  codebook_community,
  codebook_hope,
  codebook_empowerment
) %>% 
  rename(NewValue = "New Value") %>% 
  #if_else() must work with characters
  mutate(CombinedValues = if_else(is.na(NewValue), Value, as.character(NewValue)),
         Week = "Pre-Survey")
```