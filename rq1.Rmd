---
title: "BQL Data Analysis: Research Question 1"
author: "Jackie Chin & Mia Forsline"
date: "2025-04-11"
output: html_document
---

# Objective

- To pull up the descriptives/demographic data for the Black, Queer & Liberated mental health intervention project. 
- To clean the data
- To summarize and visualize demographic data 

This is part of Jacquelyn Chin's 2025 dissertation defense. Almost at the finish line, baddie!!

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
options(knitr.duplicate.label = "allow",
        scipen = 999)

#install packages if necessary, then load libraries
if (!require(librarian)){
  install.packages("librarian")
  library(librarian)
}
librarian::shelf(
  #expss, #to make tables
  here, #to build file paths
  janitor, #for column name cleaning
  lubridate, #for working with dates 
  readxl, #read in Excel files
  stringr, #to clean data 
  tidyr, #data cleaning
  tidyverse, #general data cleaning functions and collection of common packages
  dplyr, #case_match
  writexl #save Excel files
  )
```

# Read in Survey Data
- The raw Excel data was exported from Qualtrics 

First, create an R chunk: Command + option + I makes a code chunk appear on the Mac

Note: you can run an entire R code chunk by pressing the green arrow button OR using Shift + Command + Return on a Mac 

```{r read_in_data}
#filepath & here function takes everything in green & helps R locate the correct file path
filepath <- here("../")
#"../" means one file outside of this file
print(filepath) #double check the filepath is correct
#filename function tells R where the exact file is located

filename <- list.files(path = filepath, pattern = "BQL Survey Data - CLEAN - FINAL.xlsx") #which file do we want to read in?

print(filename) #check which file we have selected
#print function means 'show me what is in this file'

#read_excel() reads in Excel files
pre_survey <- read_excel(path = here(filepath, filename[1]), sheet = 1) 
week1 <- read_excel(path = here(filepath, filename[1]), sheet = 2) 
week2 <- read_excel(path = here(filepath, filename[1]), sheet = 3)
week3 <- read_excel(path = here(filepath, filename[1]), sheet = 4)
week4 <- read_excel(path = here(filepath, filename[1]), sheet = 5)
week5 <- read_excel(path = here(filepath, filename[1]), sheet = 6)
week6 <- read_excel(path = here(filepath, filename[1]), sheet = 7)
post_survey <- read_excel(path = here(filepath, filename[1]), sheet = 8)
follow_up <- read_excel(path = here(filepath, filename[1]), sheet = 9)
```

# Clean the data 
We want to drop the "dummy" participants from pre-survey results 
- AKA we want to remove fake data based on Q1
- Jackie indicated that there are 3 real participants: BELL, BER, and LAS
- We will remove everyone else 

Week 1 had no real data

Refer to BQL Survey Data - CLEAN - FINAL to see how many real participants completed each week's survey

```{r}
#(option + minus sign) is the keyboard shortcut for the assignment arrow (<-)
##you can also type out the assignment arrow

#first, we will create a "clean" version of the data based on the original BQL_Data object
pre_survey_clean <- pre_survey %>% 
  #(shift + command + m) creates a pipe symbol
  
  #then we will filter based on column Q1
  filter(
    Q1 == "BELL" | Q1 == "BER" | Q1 == "LAS"
  ) %>% 
  
  #then we will drop rows that have NA values in column Q4 because this row is incomplete data 
  drop_na(Q4)
#filter function tells Data what to pull out from the Excel sheet

week2_clean <- week2 %>% 
  mutate(
    Q1 = toupper(Q1)
  ) %>% 
  filter(
    Q1 == "BELL" | Q1 == "LAS" | Q1 == "TOR"
  )

week3_clean <- week3 %>% 
  mutate(
    Q1 = toupper(Q1)
  ) %>% 
  filter(
    Q1 == "BAL" | Q1 == "LAS" | Q1 == "TOR"
  )

week4_clean <- week4 %>% 
  mutate(
    Q1 = toupper(Q1)
  ) %>% 
  filter(
    Q1 == "LAS" | Q1 == "TOR"
  )

week5_clean <- week5 %>% 
  mutate(
    Q1 = toupper(Q1)
  ) %>% 
  filter(
    Q1 == "LAS" | Q1 == "TOR"
  )

week6_clean <- week6 %>% 
  mutate(
    Q1 = toupper(Q1)
  ) %>% 
  filter(
    Q1 == "LAS"
  )

post_survey_clean <- post_survey %>% 
  mutate(
    Q1 = toupper(Q1)
  ) %>% 
  filter(
    Q1 == "LAS"
  )

follow_up_clean <- follow_up %>% 
  mutate(
    Q1 = toupper(Q1)
  ) %>% 
  filter(
    Q1 == "TOR"
  )
```

# Descriptive/Demographic Data

Next, we want to count/tally up Descriptive numbers from pre-survey data

NUMBER (#) of people who checked each category
- Race/Ethnicity
- Gender
- Sexual Orientation
- Relationship Status
- Education
- Employment
- Income
- Political Action

First, we will look at all the questions participants answered (in the Pre-Survey)

```{r questions}
questions <- pre_survey %>% 
  filter(StartDate == "Start Date") %>% 
  pivot_longer(
    cols = starts_with("Q"),
    names_to = "Question",
    values_to = "Description"
  ) %>% 
  select(
    Question,
    Description
  )

nrow(questions)
```

Next, we will read about how to [Recode Variables](https://www.anyamemensah.com/blog/recoding) in R. 

Then, we will read in the Code Book Jackie developed

```{r codebook}
#filepath & here function takes everything in green & helps R locate the correct file path
filepath <- here("../")
#"../" means one file outside of this file
print(filepath) #double check the filepath is correct
#filename function tells R where the exact file is located

filename <- list.files(path = filepath, pattern = "BQL Master Codebook.xlsx") #which file do we want to read in?

print(filename) #check which file we have selected
#print function means 'show me what is in this file'

#4 columns
codebook_demographics <- read_excel(path = here(filepath, filename[1]), sheet = "Demographics") %>% 
  mutate("Source Construct" = NA,
         "Reverse" = NA,
         "New Value" = NA)
codebook_black <- read_excel(path = here(filepath, filename[1]), sheet = "Black Identity") %>% 
  mutate("Source Construct" = NA,
         "Reverse" = NA,
         "New Value" = NA)
codebook_lgbt <- read_excel(path = here(filepath, filename[1]), sheet = "LGBTQIA+ Identity Scale") %>% 
  mutate("Source Construct" = NA,
         "Reverse" = NA,
         "New Value" = NA)
codebook_action <- read_excel(path = here(filepath, filename[1]), sheet = "Critical Action") %>% 
  mutate("Source Construct" = NA,
         "Reverse" = NA,
         "New Value" = NA)
codebook_hope <- read_excel(path = here(filepath, filename[1]), sheet = "Radical Hope") %>% 
  mutate("Source Construct" = NA,
         "Reverse" = NA,
         "New Value" = NA)
codebook_empowerment <- read_excel(path = here(filepath, filename[1]), sheet = "Empowerment") %>% 
  mutate("Source Construct" = NA,
         "Reverse" = NA,
         "New Value" = NA)

#source construct = 5 columns
codebook_anxiety <- read_excel(path = here(filepath, filename[1]), sheet = "PHQ-4 Anxiety Depression") %>%
  mutate() %>% 
  mutate("Reverse" = NA,
         "New Value" = NA)
codebook_ryff <- read_excel(path = here(filepath, filename[1]), sheet = "Ryff Wellbeing") %>% 
  mutate("Reverse" = NA,
         "New Value" = NA)

#reverse-coding = 6 columns
codebook_consciousness <- read_excel(path = here(filepath, filename[1]), sheet = "Critical Consciousness") %>% 
  mutate("Source Construct" = NA)
codebook_community <- read_excel(path = here(filepath, filename[1]), sheet = "Collective Self-Esteem") %>% 
  mutate("Source Construct" = NA)



codebook <- rbind(
  codebook_demographics,
  codebook_anxiety,
  codebook_ryff,
  codebook_black,
  codebook_lgbt,
  codebook_action,
  codebook_consciousness,
  codebook_community,
  codebook_hope,
  codebook_empowerment
) %>% 
  rename(NewValue = "New Value") %>% 
  #if_else() must work with characters
  mutate(CombinedValues = if_else(is.na(NewValue), Value, as.character(NewValue)))
```


Then we will look at what participants answered when asked about: 
- their Race/Ethnicity (Q36 and Q36_11_TEXT)

```{r race_ethnicity}
race_ethnicity <- pre_survey_clean %>% 
  select(Q1,
         Q36,
         Q36_11_TEXT) %>% 
  pivot_longer(
    cols = !Q1, 
    names_to = "Variable Name",
    values_to = "Value"
  ) %>% 
  mutate(Value = strsplit(as.character(Value), ",")) %>% 
    unnest(Value) 

#join the codebook descriptions
race_ethnicity_description <- left_join(x = race_ethnicity, y = codebook) %>% 
  select(-"Source Construct") %>% 
  mutate("Question Text" = "Race") 

##add Creole as an option 
race_ethnicity_description$Label[race_ethnicity_description$Q1 == "LAS" & race_ethnicity_description$Value == "Creole"] <- "Creole"

race_ethnicity_summary <- race_ethnicity_description %>% 
  #remove Another race...
  filter(
    Label != "Another race/ethnicity (please specify)"
  ) %>% 
  group_by(Label) %>% 
  summarise(
    Label = Label, 
    n = n(),
  ) %>% 
  ungroup() %>% 
  unique() %>% 
  drop_na() %>% 
  adorn_totals(where = "row", na.rm = TRUE, name = "Total")

race_ethnicity_summary$n[race_ethnicity_summary$Label == "Total"] <- length(unique(race_ethnicity$Q1))

print(race_ethnicity_summary)
```

- Gender (Q34 and Q34_7_TEXT)

```{r gender}
gender <- pre_survey_clean %>% 
  select(Q1,
         Q34,
         Q34_7_TEXT) %>% 
  pivot_longer(
    cols = !Q1, 
    names_to = "Variable Name",
    values_to = "Value"
  ) %>% 
  mutate(Value = strsplit(as.character(Value), ",")) %>% 
    unnest(Value) %>% 
  drop_na(Value)

#join the codebook descriptions
gender_description <- left_join(x = gender, y = codebook) %>% 
  select(-"Source Construct") %>% 
  mutate("Question Text" = "Gender") 

gender_summary <- gender_description %>% 
  group_by(Label) %>% 
  summarise(
    Label = Label, 
    n = n()
  ) %>% 
  ungroup() %>% 
  unique() %>% 
  drop_na() %>% 
  adorn_totals(where = "row", na.rm = TRUE, name = "Total")

gender_summary$n[gender_summary$Label == "Total"] <- length(unique(gender$Q1))

print(gender_summary)
```

- Sexual Orientation (Q35 and Q35_10_TEXT)

```{r sexual_orientation}
sexual_orientation <- pre_survey_clean %>% 
  select(Q1,
         Q35,
         Q35_10_TEXT)  %>% 
  pivot_longer(
    cols = !Q1, 
    names_to = "Variable Name",
    values_to = "Value"
  ) %>% 
  mutate(Value = strsplit(as.character(Value), ",")) %>% 
    unnest(Value) %>% 
  drop_na(Value)

#join the codebook descriptions
sexual_orientation_description <- left_join(x = sexual_orientation, y = codebook) %>% 
  select(-"Source Construct") %>% 
  mutate("Question Text" = "Sexual Orientation") 

sexual_orientation_summary <- sexual_orientation_description %>% 
  group_by(Label) %>% 
  summarise(
    Label = Label, 
    n = n()
  ) %>% 
  ungroup() %>% 
  unique() %>% 
  drop_na() %>% 
  adorn_totals(where = "row", na.rm = TRUE, name = "Total")

sexual_orientation_summary$n[sexual_orientation_summary$Label == "Total"] <- length(unique(sexual_orientation$Q1))

print(sexual_orientation_summary)
```

- Relationship Status (Q5 and Q5_7_TEXT)

```{r relationship_status}
relationship_status <- pre_survey_clean %>% 
  select(Q1,
         Q5,
         Q5_7_TEXT) %>% 
  pivot_longer(
    cols = !Q1, 
    names_to = "Variable Name",
    values_to = "Value"
  ) %>% 
  mutate(Value = strsplit(as.character(Value), ",")) %>% 
    unnest(Value) %>% 
  drop_na(Value)

#join the codebook descriptions
relationship_status_description <- left_join(x = relationship_status, y = codebook) %>% 
  select(-"Source Construct") %>% 
  mutate("Question Text" = "Relationship Status") 

relationship_status_summary <- relationship_status_description %>% 
  group_by(Label) %>% 
  summarise(
    Label = Label, 
    n = n()
  ) %>% 
  ungroup() %>% 
  unique() %>% 
  drop_na() %>% 
  adorn_totals(where = "row", na.rm = TRUE, name = "Total")

relationship_status_summary$n[relationship_status_summary$Label == "Total"] <- length(unique(relationship_status$Q1))

print(relationship_status_summary)
```

- Education (Q4)

```{r education}
education <- pre_survey_clean %>% 
  select(Q1,
         Q4) %>% 
  pivot_longer(
    cols = !Q1, 
    names_to = "Variable Name",
    values_to = "Value"
  ) %>% 
  mutate(Value = strsplit(as.character(Value), ",")) %>% 
    unnest(Value) %>% 
  drop_na(Value)

#join the codebook descriptions
education_description <- left_join(x = education, y = codebook) %>% 
  select(-"Source Construct") %>% 
  mutate("Question Text" = "Education") 

education_summary <- education_description %>% 
  group_by(Label) %>% 
  summarise(
    Label = Label, 
    n = n()
  ) %>% 
  ungroup() %>% 
  unique() %>% 
  drop_na() %>% 
  adorn_totals(where = "row", na.rm = TRUE, name = "Total")

education_summary$n[education_summary$Label == "Total"] <- length(unique(education$Q1))

print(education_summary)
```

- Employment (Q41 and Q41_4_TEXT)

```{r employment}
employment <- pre_survey_clean %>% 
  select(Q1,
         Q41,
         Q41_4_TEXT) %>% 
  pivot_longer(
    cols = !Q1, 
    names_to = "Variable Name",
    values_to = "Value"
  ) %>% 
  mutate(Value = strsplit(as.character(Value), ",")) %>% 
    unnest(Value) %>% 
  drop_na(Value)

#join the codebook descriptions
employment_description <- left_join(x = employment, y = codebook) %>% 
  select(-"Source Construct") %>% 
  mutate("Question Text" = "Employment") 

employment_summary <- employment_description %>% 
  group_by(Label) %>% 
  summarise(
    Label = Label, 
    n = n()
  ) %>% 
  ungroup() %>% 
  unique() %>% 
  drop_na() %>% 
  adorn_totals(where = "row", na.rm = TRUE, name = "Total")

employment_summary$n[employment_summary$Label == "Total"] <- length(unique(employment$Q1))

print(employment_summary)


```

- Income (Q6)

```{r income}
income <- pre_survey_clean %>% 
  select(Q1,
         Q6) %>% 
  pivot_longer(
    cols = !Q1, 
    names_to = "Variable Name",
    values_to = "Value"
  ) %>% 
  mutate(Value = strsplit(as.character(Value), ",")) %>% 
    unnest(Value) %>% 
  drop_na(Value)

#join the codebook descriptions
income_description <- left_join(x = income, y = codebook) %>% 
  select(-"Source Construct") %>% 
  mutate("Question Text" = "Income") 

income_summary <- income_description %>% 
  group_by(Label) %>% 
  summarise(
    Label = Label, 
    n = n()
  ) %>% 
  ungroup() %>% 
  unique() %>% 
  drop_na() %>% 
  adorn_totals(where = "row", na.rm = TRUE, name = "Total")

income_summary$n[income_summary$Label == "Total"] <- length(unique(income$Q1))

print(income_summary)
```

- Critical Action

Q17_1 through Q17_5

```{r critical_action1}
political_action <- pre_survey_clean %>% 
  select(Q1,
         Q17_1
         ) %>% 
  pivot_longer(
    cols = !Q1, 
    names_to = "Variable Name",
    values_to = "Value"
  ) %>% 
  mutate(Value = strsplit(as.character(Value), ",")) %>% 
    unnest(Value) %>% 
  drop_na(Value)

#join the codebook descriptions
political_action_description <- left_join(x = political_action, y = codebook) %>% 
  select(-"Source Construct") %>% 
  mutate("Question Text" = "Critical Action") 

political_action_summary <- political_action_description %>% 
  group_by(Label) %>% 
  summarise(
    Label = Label, 
    n = n()
  ) %>% 
  ungroup() %>% 
  unique() %>% 
  drop_na() %>% 
  adorn_totals(where = "row", na.rm = TRUE, name = "Total")

political_action_summary$n[political_action_summary$Label == "Total"] <- length(unique(political_action$Q1))

print(political_action_summary)
```

```{r critical_action2}
political_action <- pre_survey_clean %>% 
  select(Q1,
         Q17_2
         ) %>% 
  pivot_longer(
    cols = !Q1, 
    names_to = "Variable Name",
    values_to = "Value"
  ) %>% 
  mutate(Value = strsplit(as.character(Value), ",")) %>% 
    unnest(Value) %>% 
  drop_na(Value)

#join the codebook descriptions
political_action_description <- left_join(x = political_action, y = codebook) %>% 
  select(-"Source Construct") %>% 
  mutate("Question Text" = "Critical Action") 

political_action_summary <- political_action_description %>% 
  group_by(Label) %>% 
  summarise(
    Label = Label, 
    n = n()
  ) %>% 
  ungroup() %>% 
  unique() %>% 
  drop_na() %>% 
  adorn_totals(where = "row", na.rm = TRUE, name = "Total")

political_action_summary$n[political_action_summary$Label == "Total"] <- length(unique(political_action$Q1))

print(political_action_summary)
```

```{r critical_action3}
political_action <- pre_survey_clean %>% 
  select(Q1,
         Q17_3
         ) %>% 
  pivot_longer(
    cols = !Q1, 
    names_to = "Variable Name",
    values_to = "Value"
  ) %>% 
  mutate(Value = strsplit(as.character(Value), ",")) %>% 
    unnest(Value) %>% 
  drop_na(Value)

#join the codebook descriptions
political_action_description <- left_join(x = political_action, y = codebook) %>% 
  select(-"Source Construct") %>% 
  mutate("Question Text" = "Critical Action") 

political_action_summary <- political_action_description %>% 
  group_by(Label) %>% 
  summarise(
    Label = Label, 
    n = n()
  ) %>% 
  ungroup() %>% 
  unique() %>% 
  drop_na() %>% 
  adorn_totals(where = "row", na.rm = TRUE, name = "Total")

political_action_summary$n[political_action_summary$Label == "Total"] <- length(unique(political_action$Q1))

print(political_action_summary)
```

```{r critical_action4}
political_action <- pre_survey_clean %>% 
  select(Q1,
         Q17_4
         ) %>% 
  pivot_longer(
    cols = !Q1, 
    names_to = "Variable Name",
    values_to = "Value"
  ) %>% 
  mutate(Value = strsplit(as.character(Value), ",")) %>% 
    unnest(Value) %>% 
  drop_na(Value)

#join the codebook descriptions
political_action_description <- left_join(x = political_action, y = codebook) %>% 
  select(-"Source Construct") %>% 
  mutate("Question Text" = "Critical Action") 

political_action_summary <- political_action_description %>% 
  group_by(Label) %>% 
  summarise(
    Label = Label, 
    n = n()
  ) %>% 
  ungroup() %>% 
  unique() %>% 
  drop_na() %>% 
  adorn_totals(where = "row", na.rm = TRUE, name = "Total")

political_action_summary$n[political_action_summary$Label == "Total"] <- length(unique(political_action$Q1))

print(political_action_summary)
```

```{r critical_action5}
political_action <- pre_survey_clean %>% 
  select(Q1,
         Q17_5
         ) %>% 
  pivot_longer(
    cols = !Q1, 
    names_to = "Variable Name",
    values_to = "Value"
  ) %>% 
  mutate(Value = strsplit(as.character(Value), ",")) %>% 
    unnest(Value) %>% 
  drop_na(Value)

#join the codebook descriptions
political_action_description <- left_join(x = political_action, y = codebook) %>% 
  select(-"Source Construct") %>% 
  mutate("Question Text" = "Critical Action") 

political_action_summary <- political_action_description %>% 
  group_by(Label) %>% 
  summarise(
    Label = Label, 
    n = n()
  ) %>% 
  ungroup() %>% 
  unique() %>% 
  drop_na() %>% 
  adorn_totals(where = "row", na.rm = TRUE, name = "Total")

political_action_summary$n[political_action_summary$Label == "Total"] <- length(unique(political_action$Q1))

print(political_action_summary)
```

# RQ 1: Scales

TASK FOR JACKIE: Double-check that descriptions are correct for analysis

Scale
Measure
Which Weeks to Pull
How Many People per timepoint
Helpful to know their codes (e.g. Las, Bell, Tor)

## PHQ-4 Anxiety & Depression

PHQ-4 Anxiety & Depression (ALL ITEMS in Q8.Q8_1, Q8_2, Q8_3, and Q8_4)
- Averaging the total of this measure's items for 3 people
- Reporting the mean average scores in Pre-Survey > Week 2 > Week 4 > Week 6 > Post-Test > Follow-Up 
- Group by person & average the scores

MANUSCRIPT TEXT:
- H1a: Participants were hypothesized to report lower scores on the PHQ-4 Anxiety & Depression scale at post-survey compared to pre-survey. Descriptive analysis showed that at pre-test, the
mean average score was 1.92 (n=3); at week 2, the average score was 1.3 (n=3); at week 4, the mean average score was 0.75 (n=2); at Week 6, the average was 1 (n=1); and at follow-up, the  average score was 1 (n=1).

```{r pre_anxiety}
pre_anxiety <- pre_survey_clean %>% 
  select(
    Q1, 
    Q8_1,
    Q8_2,
    Q8_3,
    Q8_4
  ) %>% 
  mutate(
    Q8_1 = as.numeric(Q8_1),
    Q8_2 = as.numeric(Q8_2),
    Q8_3 = as.numeric(Q8_3),
    Q8_4 = as.numeric(Q8_4),
  )

n <- (ncol(pre_anxiety) - 1)

pre_anxiety$average <- (pre_anxiety$Q8_1 + pre_anxiety$Q8_2 + pre_anxiety$Q8_3 + pre_anxiety$Q8_4) / n

print(pre_anxiety)
```


```{r}
pre_anxiety_mean_avg <- round(mean(pre_anxiety$average), digits = 2)
print(pre_anxiety_mean_avg)
```

```{r week2_anxiety}
week2_anxiety <- week2_clean %>% 
  select(
    Q1, 
    Q8_1,
    Q8_2,
    Q8_3,
    Q8_4
  ) %>% 
  
  #keep only the first digit in each column 
  mutate(Q8_1 = gsub("(^\\d{1}).*", "\\1", Q8_1),
         Q8_2 = gsub("(^\\d{1}).*", "\\1", Q8_2),
         Q8_3 = gsub("(^\\d{1}).*", "\\1", Q8_3),
         Q8_4 = gsub("(^\\d{1}).*", "\\1", Q8_4)) %>% 
  mutate(
    Q8_1 = as.numeric(Q8_1),
    Q8_2 = as.numeric(Q8_2),
    Q8_3 = as.numeric(Q8_3),
    Q8_4 = as.numeric(Q8_4),
  )

n <- (ncol(week2_anxiety) - 1)

week2_anxiety$average <- (week2_anxiety$Q8_1 + week2_anxiety$Q8_2 + week2_anxiety$Q8_3 + week2_anxiety$Q8_4) / n

print(week2_anxiety)
```


```{r}
week2_anxiety_mean_avg <- round(mean(week2_anxiety$average), digits = 2)
print(week2_anxiety_mean_avg)
```

```{r week4_anxiety}
week4_anxiety <- week4_clean %>% 
  select(
    Q1, 
    Q8_1,
    Q8_2,
    Q8_3,
    Q8_4
  ) %>% 
  
  #keep only the first digit in each column 
  mutate(Q8_1 = gsub("(^\\d{1}).*", "\\1", Q8_1),
         Q8_2 = gsub("(^\\d{1}).*", "\\1", Q8_2),
         Q8_3 = gsub("(^\\d{1}).*", "\\1", Q8_3),
         Q8_4 = gsub("(^\\d{1}).*", "\\1", Q8_4)) %>% 
  mutate(
    Q8_1 = as.numeric(Q8_1),
    Q8_2 = as.numeric(Q8_2),
    Q8_3 = as.numeric(Q8_3),
    Q8_4 = as.numeric(Q8_4),
  )

n <- (ncol(week4_anxiety) - 1)

week4_anxiety$average <- (week4_anxiety$Q8_1 + week4_anxiety$Q8_2 + week4_anxiety$Q8_3 + week4_anxiety$Q8_4) / n

print(week4_anxiety)
```


```{r}
week4_anxiety_mean_avg <- round(mean(week4_anxiety$average), digits = 2)
print(week4_anxiety_mean_avg)
```

```{r week6_anxiety}
week6_anxiety <- week6_clean %>% 
  select(
    Q1, 
    Q8_1,
    Q8_2,
    Q8_3,
    Q8_4
  ) %>% 
  
  #keep only the first digit in each column 
  mutate(Q8_1 = gsub("(^\\d{1}).*", "\\1", Q8_1),
         Q8_2 = gsub("(^\\d{1}).*", "\\1", Q8_2),
         Q8_3 = gsub("(^\\d{1}).*", "\\1", Q8_3),
         Q8_4 = gsub("(^\\d{1}).*", "\\1", Q8_4)) %>% 
  mutate(
    Q8_1 = as.numeric(Q8_1),
    Q8_2 = as.numeric(Q8_2),
    Q8_3 = as.numeric(Q8_3),
    Q8_4 = as.numeric(Q8_4),
  )

n <- (ncol(week6_anxiety) - 1)

week6_anxiety$average <- (week6_anxiety$Q8_1 + week6_anxiety$Q8_2 + week6_anxiety$Q8_3 + week6_anxiety$Q8_4) / n

print(week6_anxiety)
```

```{r follow_up_anxiety}
follow_up_anxiety <- follow_up_clean %>% 
  select(
    Q1, 
    Q8_1,
    Q8_2,
    Q8_3,
    Q8_4
  ) %>% 
  
  #keep only the first digit in each column 
  mutate(Q8_1 = gsub("(^\\d{1}).*", "\\1", Q8_1),
         Q8_2 = gsub("(^\\d{1}).*", "\\1", Q8_2),
         Q8_3 = gsub("(^\\d{1}).*", "\\1", Q8_3),
         Q8_4 = gsub("(^\\d{1}).*", "\\1", Q8_4)) %>% 
  mutate(
    Q8_1 = as.numeric(Q8_1),
    Q8_2 = as.numeric(Q8_2),
    Q8_3 = as.numeric(Q8_3),
    Q8_4 = as.numeric(Q8_4),
  )

n <- (ncol(follow_up_anxiety) - 1)

follow_up_anxiety$average <- (follow_up_anxiety$Q8_1 + follow_up_anxiety$Q8_2 + follow_up_anxiety$Q8_3 + follow_up_anxiety$Q8_4) / n

print(follow_up_anxiety)
```

```{r mean_average_summary}
# R program to illustrate 
# data frame from vector 

#how many surveys to summarize
Survey <- c("Pre-Survey", 
            "Week 2", 
            "Week 4", 
            "Week 6", 
            "Follow-Up") 

#how many participants per survey ?
Participants <- c(nrow(pre_anxiety), 
            nrow(week2_anxiety),
            nrow(week4_anxiety),
            nrow(week6_anxiety),
            nrow(follow_up_anxiety)) 

#mean average score per week
MeanAverage <- c(pre_anxiety_mean_avg, 
                  week2_anxiety_mean_avg, 
                  week4_anxiety_mean_avg, 
                  NA,
                  NA)

#create the data frame 
class.df <- data.frame(Survey,
                      Participants,
                      MeanAverage) 
print(class.df)
```


## Ryff Psychological Wellbeing Scale

All Q9 questions

H1b: Participants were hypothesized to report higher scores on the Ryff Psychological Wellbeing Scale at post-test and follow-up than pre-test. Descriptive analysis showed that at pre-test, the mean average score was 3.33; at post-test, the mean average was 3; and at follow-up, the mean average score was 3.39 suggesting…. 

```{r pre_rhyff}
pre_rhyff <- pre_survey_clean %>% 
  select(
    Q1, 
    starts_with("Q9_")
  ) %>% 
  #change class to numeric for all columns that start with "Q9_"
  mutate_at(vars(starts_with("Q9_")), funs(as.numeric(as.character(.))))

#how many questions are asked
n <- (ncol(pre_rhyff) - 1)

#calculate the mean score per participant
pre_rhyff$average <- rowMeans(pre_rhyff[grep('^Q9_', names(pre_rhyff))])

print(pre_rhyff)

pre_rhyff_mean_avg <- round(mean(pre_rhyff$average), digits = 2)
print(pre_rhyff_mean_avg)
```

```{r post_rhyff}
post_rhyff <- post_survey_clean %>% 
  select(
    Q1, 
    starts_with("Q9_")
  ) %>% 
  #keep only the first digit
  mutate(across(starts_with("Q9_"), ~ gsub("(^\\d{1}).*", "\\1", .))) %>% 
  #change class to numeric for all columns that start with "Q9_"
  mutate_at(vars(starts_with("Q9_")), funs(as.numeric(as.character(.))))

#how many questions are asked
n <- (ncol(post_rhyff) - 1)
print(n)

#calculate the mean score per participant
post_rhyff$average <- rowMeans(post_rhyff[grep('^Q9_', names(post_rhyff))])

print(post_rhyff)

post_rhyff_mean_avg <- mean(post_rhyff$avg)
print(post_rhyff_mean_avg)
```

```{r follow_up_rhyff}
follow_up_rhyff <- follow_up_clean %>% 
  select(
    Q1, 
    starts_with("Q9_")
  ) %>% 
  #keep only the first digit
  mutate(across(starts_with("Q9_"), ~ gsub("(^\\d{1}).*", "\\1", .))) %>% 
  #change class to numeric for all columns that start with "Q9_"
  mutate_at(vars(starts_with("Q9_")), funs(as.numeric(as.character(.))))

#how many questions are asked
n <- (ncol(follow_up_rhyff) - 1)
print(n)

#calculate the mean score per participant
follow_up_rhyff$average <- round(rowMeans(follow_up_rhyff[grep('^Q9_', names(follow_up_rhyff))]), digits = 2)

print(follow_up_rhyff)

follow_up_rhyff_mean_avg <- mean(follow_up_rhyff$avg)
print(follow_up_rhyff_mean_avg)
```

```{r mean_average_summary}
# R program to illustrate 
# data frame from vector 

#how many surveys to summarize
Survey <- c("Pre-Survey", 
            "Post-Survey", 
            "Follow-Up") 

#how many participants per survey ?
Participants <- c(nrow(pre_rhyff), 
            nrow(post_rhyff),
            nrow(follow_up_rhyff)) 

#mean average score per week
MeanAverage <- c(pre_rhyff_mean_avg, 
                 post_rhyff_mean_avg, 
                 follow_up_rhyff_mean_avg)

Average <- c(NA, 
             post_rhyff$average,
             follow_up_rhyff$average)

#create the data frame 
class.df <- data.frame(Survey,
                      Participants,
                      MeanAverage,
                      Average) 
print(class.df)
```

#Black Identity

Q11 questions

H1c: Participants were hypothesized to report higher scores on the Black Identity Development Scale at post-test and follow-up than at pre-test. Descriptive analysis showed that at pre-test, the mean average score was 3.38 (n=3); at post-test, the  average was 3.52 (n=1); and at follow-up, the  average score was 3.48 (n=1), suggesting... 

```{r pre_black}
pre_black <- pre_survey_clean %>% 
  select(
    Q1, 
    starts_with("Q11_")
  ) %>% 
  #change class to numeric for all columns that start with "Q9_"
  mutate_at(vars(starts_with("Q11_")), funs(as.numeric(as.character(.))))

#how many questions are asked
n <- (ncol(pre_black) - 1)
print(n)
if(n >= ncol(pre_black))stop("Check n")

#calculate the mean score per participant
pre_black$average <- round(rowMeans(pre_black[grep('^Q11_', names(pre_black))]), digits = 2)

print(pre_black)

pre_black_mean_avg <- round(mean(pre_black$average), digits = 2)
print(pre_black_mean_avg)
```

```{r post_black}
post_black <- post_survey_clean %>% 
  select(
    Q1, 
    starts_with("Q11_")
  ) %>% 
  #keep only numeric values
  mutate(across(starts_with("Q11_"), ~ gsub("[^0-9.-]+", "", .))) %>% 
  #change class to numeric for all columns that start with "Q11_"
  mutate_at(vars(starts_with("Q11_")), funs(as.numeric(as.character(.))))

#how many questions are asked
n <- (ncol(post_black) - 1)
print(n)

#calculate the mean score per participant
post_black$average <- round(rowMeans(post_black[grep('^Q11_', names(post_black))]), digits = 2)

print(post_black)

post_black_mean_avg <- mean(post_black$average)
print(post_black_mean_avg)
```

```{r follow_up_black}
follow_up_black <- follow_up_clean %>% 
  select(
    Q1, 
    starts_with("Q11_")
  ) %>% 
  #keep only numeric values
  mutate(across(starts_with("Q11_"), ~ gsub("[^0-9.-]+", "", .))) %>% 
  #change class to numeric for all columns that start with "Q11_"
  mutate_at(vars(starts_with("Q11_")), funs(as.numeric(as.character(.))))

#how many questions are asked
n <- (ncol(follow_up_black) - 1)
print(n)

#calculate the mean score per participant
follow_up_black$average <- round(rowMeans(follow_up_black[grep('^Q11_', names(follow_up_black))]), digits = 2)

print(follow_up_black)

follow_up_black_mean_avg <- mean(follow_up_black$avg)
print(follow_up_black_mean_avg)
```

```{r mean_average_summary}
# R program to illustrate 
# data frame from vector 

#how many surveys to summarize
Survey <- c("Pre-Survey", 
            "Post-Survey", 
            "Follow-Up") 

#how many participants per survey ?
Participants <- c(nrow(pre_black), 
            nrow(post_black),
            nrow(follow_up_black)) 

#mean average score per week
MeanAverage <- c(pre_black_mean_avg, 
                 NA, 
                 follow_up_black_mean_avg)

Average <- c(NA, 
             post_black$average,
             follow_up_black$average)

#create the data frame 
class.df <- data.frame(Survey,
                      Participants,
                      MeanAverage,
                      Average) 
print(class.df)
```

## LGBT Identity 

All Q12 questions

H1d: Participants were hypothesized to report higher scores on the LGBT Positive Identity Measure at post-test and follow-up than at pre-test. Descriptive analysis showed that at pre-test, the mean average score was ##, at post-test the mean average was ##, and at follow-up, the mean average score was ##, suggesting… 

```{r pre_lgbt}
pre_lgbt <- pre_survey_clean %>% 
  select(
    Q1, 
    starts_with("QID12_")
  ) %>% 
  #change class to numeric for all columns that start with "Q9_"
  mutate_at(vars(starts_with("QID12_")), funs(as.numeric(as.character(.))))

#how many questions are asked
n <- (ncol(pre_lgbt) - 1)
print(n)
if(n >= ncol(pre_lgbt))stop("Check n")

#calculate the mean score per participant
pre_lgbt$average <- round(rowMeans(pre_lgbt[grep('^QID12_', names(pre_lgbt))]), digits = 2)

print(pre_lgbt)

pre_lgbt_mean_avg <- round(mean(pre_lgbt$average), digits = 2)
print(pre_lgbt_mean_avg)
```


```{r post_lgbt}
post_lgbt <- post_survey_clean %>% 
  select(
    Q1, 
    starts_with("QID12_")
  ) %>% 
  #keep only numeric values
  mutate(across(starts_with("QID12_"), ~ gsub("[^0-9.-]+", "", .))) %>% 
  #change class to numeric for all columns that start with "QID12_"
  mutate_at(vars(starts_with("QID12_")), funs(as.numeric(as.character(.))))

#how many questions are asked
n <- (ncol(post_lgbt) - 1)
print(n)

#calculate the mean score per participant
post_lgbt$average <- round(rowMeans(post_lgbt[grep('^QID12_', names(post_lgbt))]), digits = 2)

print(post_lgbt)

post_lgbt_mean_avg <- mean(post_lgbt$average)
print(post_lgbt_mean_avg)
```

```{r follow_up_lgbt}
follow_up_lgbt <- follow_up_clean %>% 
  select(
    Q1, 
    starts_with("Q11_")
  ) %>% 
  #keep only numeric values
  mutate(across(starts_with("Q11_"), ~ gsub("[^0-9.-]+", "", .))) %>% 
  #change class to numeric for all columns that start with "Q11_"
  mutate_at(vars(starts_with("Q11_")), funs(as.numeric(as.character(.))))

#how many questions are asked
n <- (ncol(follow_up_lgbt) - 1)
print(n)

#calculate the mean score per participant
follow_up_lgbt$average <- round(rowMeans(follow_up_lgbt[grep('^Q11_', names(follow_up_lgbt))]), digits = 2)

print(follow_up_lgbt)

follow_up_lgbt_mean_avg <- mean(follow_up_lgbt$avg)
print(follow_up_lgbt_mean_avg)
```

```{r mean_average_summary}
# R program to illustrate 
# data frame from vector 

#how many surveys to summarize
Survey <- c("Pre-Survey", 
            "Post-Survey", 
            "Follow-Up") 

#how many participants per survey ?
Participants <- c(nrow(pre_lgbt), 
            nrow(post_lgbt),
            nrow(follow_up_lgbt)) 

#mean average score per week
MeanAverage <- c(pre_lgbt_mean_avg, 
                 NA, 
                 follow_up_lgbt_mean_avg)

Average <- c(NA, 
             post_lgbt$average,
             follow_up_lgbt$average)

#create the data frame 
class.df <- data.frame(Survey,
                      Participants,
                      MeanAverage,
                      Average) 
print(class.df)
```

##Critical Consciousness

H1f: Participants were hypothesized to report increased scores on the Short Critical Consciousness Scale and the Contemporary Critical Consciousness Measures I and II at post-test and follow-up compared to pre-test. Descriptive analysis showed that pre-test mean scores for each scale were ##, ##, and ## respectively, post-test scores were ##, ##, and ##, and follow-up scores were ##, ##, and ##, suggesting... 

Contains Reverse Coding 

```{r pre_consciousness}
pre_consciousness <- pre_survey_clean %>% 
  select(
    Q1, 
    starts_with("Q18_")
  ) %>% 
  #change class to numeric for all columns that start with "Q9_"
  mutate_at(vars(starts_with("Q18_")), funs(as.numeric(as.character(.)))) %>% 
  #format long data to join to codebook
  pivot_longer(cols = !Q1,
               names_to = "Variable Name",
               values_to = "Value")

#pull out the reverse codes
reverse_codes <- codebook %>% 
  filter(str_detect(Reverse, "Y")) %>% 
  select(
    "Variable Name",
    Value,
    NewValue
  ) %>% 
  mutate(
    Value = as.numeric(Value)
  )

#join the survey data to the codebook 
pre_consciousness_codebook <- left_join(x = pre_consciousness, y = reverse_codes) %>% 
  #if_else() must work with characters
  mutate(
    NewValue = as.character(NewValue),
    Value = as.character(Value),
    CorrectedValue = if_else(is.na(NewValue), Value, as.character(NewValue)))

pre_consciousness <- pre_consciousness_codebook %>% 
  select(
    -NewValue,
    -Value
  ) %>% 
  rename(Value = CorrectedValue) %>% 
  mutate(Value = as.numeric(Value)) %>% 
  pivot_wider(
    names_from = "Variable Name",
    values_from = "Value"
  )

#how many questions are asked
n <- (ncol(pre_consciousness) - 1)
print(n)
if(n >= ncol(pre_consciousness))stop("Check n")

#calculate the mean score per participant
pre_consciousness$average <- round(rowMeans(pre_consciousness[grep('^Q18_', names(pre_consciousness))]), digits = 2)

print(pre_consciousness)

pre_consciousness_mean_avg <- round(mean(pre_consciousness$average), digits = 2)
print(pre_consciousness_mean_avg)
```

```{r post_consciousness}
post_consciousness <- post_survey_clean %>% 
  select(
    Q1, 
    starts_with("Q18_")
  ) %>% 
  #keep only numeric values
  mutate(across(starts_with("Q18_"), ~ gsub("[^0-9.-]+", "", .))) %>% 
  #change class to numeric for all columns that start with "Q18_"
  mutate_at(vars(starts_with("Q18_")), funs(as.numeric(as.character(.)))) %>% 
  pivot_longer(cols = !Q1,
               names_to = "Variable Name",
               values_to = "Value")

#pull out the reverse 
reverse_codes <- codebook %>% 
  filter(str_detect(Reverse, "Y")) %>% 
  select(
    "Variable Name",
    Value,
    NewValue
  ) %>% 
  mutate(
    Value = as.numeric(Value)
  )

#join the survey data to the codebook 
post_consciousness_codebook <- left_join(x = post_consciousness, y = reverse_codes) %>% 
  #if_else() must work with characters
  mutate(
    NewValue = as.character(NewValue),
    Value = as.character(Value),
    CorrectedValue = if_else(is.na(NewValue), Value, as.character(NewValue)))

post_consciousness <- post_consciousness_codebook %>% 
  select(
    -NewValue,
    -Value
  ) %>% 
  rename(Value = CorrectedValue) %>% 
  mutate(Value = as.numeric(Value)) %>% 
  pivot_wider(
    names_from = "Variable Name",
    values_from = "Value"
  )

#how many questions are asked
n <- (ncol(post_consciousness) - 1)
print(n)

#calculate the mean score per participant
post_consciousness$average <- round(rowMeans(post_consciousness[grep('^Q18_', names(post_consciousness))]), digits = 2)

print(post_consciousness)

post_consciousness_mean_avg <- mean(post_consciousness$average)
print(post_consciousness_mean_avg)
```

```{r follow_up_consciousness}
follow_up_consciousness <- follow_up_clean %>% 
  select(
    Q1, 
    starts_with("Q18_")
  ) %>% 
  #keep only numeric values
  mutate(across(starts_with("Q18_"), ~ gsub("[^0-9.-]+", "", .))) %>% 
  #change class to numeric for all columns that start with "Q18_"
  mutate_at(vars(starts_with("Q18_")), funs(as.numeric(as.character(.)))) %>% 
  pivot_longer(cols = !Q1,
               names_to = "Variable Name",
               values_to = "Value")

#pull out the reverse 
reverse_codes <- codebook %>% 
  filter(str_detect(Reverse, "Y")) %>% 
  select(
    "Variable Name",
    Value,
    NewValue
  ) %>% 
  mutate(
    Value = as.numeric(Value)
  )

#join the survey data to the codebook 
follow_up_consciousness_codebook <- left_join(x = follow_up_consciousness, y = reverse_codes) %>% 
  #if_else() must work with characters
  mutate(
    NewValue = as.character(NewValue),
    Value = as.character(Value),
    CorrectedValue = if_else(is.na(NewValue), Value, as.character(NewValue)))

follow_up_consciousness <- follow_up_consciousness_codebook %>% 
  select(
    -NewValue,
    -Value
  ) %>% 
  rename(Value = CorrectedValue) %>% 
  mutate(Value = as.numeric(Value)) %>% 
  pivot_wider(
    names_from = "Variable Name",
    values_from = "Value"
  )

#how many questions are asked
n <- (ncol(follow_up_consciousness) - 1)
print(n)

#calculate the mean score per participant
follow_up_consciousness$average <- round(rowMeans(follow_up_consciousness[grep('^Q18_', names(follow_up_consciousness))]), digits = 2)

print(follow_up_consciousness)

follow_up_consciousness_mean_avg <- mean(follow_up_consciousness$avg)
print(follow_up_consciousness_mean_avg)
```

```{r mean_average_summary}
# R program to illustrate 
# data frame from vector 

#how many surveys to summarize
Survey <- c("Pre-Survey", 
            "Post-Survey", 
            "Follow-Up") 

#how many participants per survey ?
Participants <- c(nrow(pre_consciousness), 
            nrow(post_consciousness),
            nrow(follow_up_consciousness)) 

#mean average score per week
MeanAverage <- c(pre_consciousness_mean_avg, 
                 NA, 
                 follow_up_consciousness_mean_avg)

Average <- c(NA, 
             post_consciousness$average,
             follow_up_consciousness$average)

#create the data frame 
class.df <- data.frame(Survey,
                      Participants,
                      MeanAverage,
                      Average) 
print(class.df)
```
##Community Self-Esteem

All Q20 and Q57 questions

H1g: Participants were hypothesized to report higher scores on the Collective Self-Esteem Scale at post-test and follow-up than at pre-test. Descriptive analysis showed that at pre-test, the mean average score was ##, at post-test the mean average was ##, and at follow-up, the mean average score was ##, suggesting... 

Contains reverse coding

```{r pre_community}
pre_community <- pre_survey_clean %>% 
  select(
    Q1, 
    starts_with("Q20_")
  ) %>% 
  #change class to numeric for all columns that start with "Q9_"
  mutate_at(vars(starts_with("Q20_")), funs(as.numeric(as.character(.)))) %>% 
  #format long data to join to codebook
  pivot_longer(cols = !Q1,
               names_to = "Variable Name",
               values_to = "Value")

#pull out the reverse 
reverse_codes <- codebook %>% 
  filter(str_detect(Reverse, "Y")) %>% 
  select(
    "Variable Name",
    Value,
    NewValue
  ) %>% 
  mutate(
    Value = as.numeric(Value)
  )

#join the survey data to the codebook 
pre_community_codebook <- left_join(x = pre_community, y = reverse_codes) %>% 
  #if_else() must work with characters
  mutate(
    NewValue = as.character(NewValue),
    Value = as.character(Value),
    CorrectedValue = if_else(is.na(NewValue), Value, as.character(NewValue)))

pre_community <- pre_community_codebook %>% 
  select(
    -NewValue,
    -Value
  ) %>% 
  rename(Value = CorrectedValue) %>% 
  mutate(Value = as.numeric(Value)) %>% 
  pivot_wider(
    names_from = "Variable Name",
    values_from = "Value"
  )

#how many questions are asked
n <- (ncol(pre_community) - 1)
print(n)
if(n >= ncol(pre_community))stop("Check n")

#calculate the mean score per participant
pre_community$average <- round(rowMeans(pre_community[grep('^Q20_', names(pre_community))]), digits = 2)

print(pre_community)

pre_community_mean_avg <- round(mean(pre_community$average), digits = 2)
print(pre_community_mean_avg)
```

```{r post_community}
post_community <- post_survey_clean %>% 
  select(
    Q1, 
    starts_with("Q20_")
  ) %>% 
  #keep only numeric values
  mutate(across(starts_with("Q20_"), ~ gsub("[^0-9.-]+", "", .))) %>% 
  #change class to numeric for all columns that start with "Q20_"
  mutate_at(vars(starts_with("Q20_")), funs(as.numeric(as.character(.)))) %>% 
  pivot_longer(cols = !Q1,
               names_to = "Variable Name",
               values_to = "Value")

#pull out the reverse 
reverse_codes <- codebook %>% 
  filter(str_detect(Reverse, "Y")) %>% 
  select(
    "Variable Name",
    Value,
    NewValue
  ) %>% 
  mutate(
    Value = as.numeric(Value)
  )

#join the survey data to the codebook 
##check that the values have changed
post_community_codebook <- left_join(x = post_community, y = reverse_codes) %>% 
  #if_else() must work with characters
  mutate(
    NewValue = as.character(NewValue),
    Value = as.character(Value),
    CorrectedValue = if_else(is.na(NewValue), Value, as.character(NewValue)))

post_community <- post_community_codebook %>% 
  select(
    -NewValue,
    -Value
  ) %>% 
  rename(Value = CorrectedValue) %>% 
  mutate(Value = as.numeric(Value)) %>% 
  pivot_wider(
    names_from = "Variable Name",
    values_from = "Value"
  )

#how many questions are asked
n <- (ncol(post_community) - 1)
print(n)

#calculate the mean score per participant
post_community$average <- round(rowMeans(post_community[grep('^Q20_', names(post_community))]), digits = 2)

print(post_community)

post_community_mean_avg <- mean(post_community$average)
print(post_community_mean_avg)
```

```{r follow_up_community}
follow_up_community <- follow_up_clean %>% 
  select(
    Q1, 
    starts_with("Q20_")
  ) %>% 
  #keep only numeric values
  mutate(across(starts_with("Q20_"), ~ gsub("[^0-9.-]+", "", .))) %>% 
  #change class to numeric for all columns that start with "Q20_"
  mutate_at(vars(starts_with("Q20_")), funs(as.numeric(as.character(.)))) %>% 
  pivot_longer(cols = !Q1,
               names_to = "Variable Name",
               values_to = "Value")

#pull out the reverse 
reverse_codes <- codebook %>% 
  filter(str_detect(Reverse, "Y")) %>% 
  select(
    "Variable Name",
    Value,
    NewValue
  ) %>% 
  mutate(
    Value = as.numeric(Value)
  )

#join the survey data to the codebook 
follow_up_community_codebook <- left_join(x = follow_up_community, y = reverse_codes) %>% 
  #if_else() must work with characters
  mutate(
    NewValue = as.character(NewValue),
    Value = as.character(Value),
    CorrectedValue = if_else(is.na(NewValue), Value, as.character(NewValue)))

follow_up_community <- follow_up_community_codebook %>% 
  select(
    -NewValue,
    -Value
  ) %>% 
  rename(Value = CorrectedValue) %>% 
  mutate(Value = as.numeric(Value)) %>% 
  pivot_wider(
    names_from = "Variable Name",
    values_from = "Value"
  )

#how many questions are asked
n <- (ncol(follow_up_community) - 1)
print(n)

#calculate the mean score per participant
follow_up_community$average <- round(rowMeans(follow_up_community[grep('^Q20_', names(follow_up_community))]), digits = 2)

print(follow_up_community)

follow_up_community_mean_avg <- mean(follow_up_community$avg)
print(follow_up_community_mean_avg)
```

```{r mean_average_summary}
# R program to illustrate 
# data frame from vector 

#how many surveys to summarize
Survey <- c("Pre-Survey", 
            "Post-Survey", 
            "Follow-Up") 

#how many participants per survey ?
Participants <- c(nrow(pre_community), 
            nrow(post_community),
            nrow(follow_up_community)) 

#mean average score per week
MeanAverage <- c(pre_community_mean_avg, 
                 NA, 
                 follow_up_community_mean_avg)

Average <- c(NA, 
             post_community$average,
             follow_up_community$average)

#create the data frame 
class.df <- data.frame(Survey,
                      Participants,
                      MeanAverage,
                      Average) 
print(class.df)
```

##Radical Hope

All Q21 questions

H1h: Participants were hypothesized to report increased Radical Hope from pre- to post-test and follow-up. Descriptive analysis showed that at pre-test, the mean average score was ##, at post-test the mean average was ##, and at follow-up, the mean average score was ##, suggesting... 

```{r pre_hope}
pre_hope <- pre_survey_clean %>% 
  select(
    Q1, 
    starts_with("Q21_")
  ) %>% 
  #change class to numeric for all columns that start with "Q9_"
  mutate_at(vars(starts_with("Q21_")), funs(as.numeric(as.character(.))))

#how many questions are asked
n <- (ncol(pre_hope) - 1)
print(n)
if(n >= ncol(pre_hope))stop("Check n")

#calculate the mean score per participant
pre_hope$average <- round(rowMeans(pre_hope[grep('^Q21_', names(pre_hope))]), digits = 2)

print(pre_hope)

pre_hope_mean_avg <- round(mean(pre_hope$average), digits = 2)
print(pre_hope_mean_avg)
```

No numeric values 

What number is Very Much ? 

```{r post_hope}
post_hope <- post_survey_clean %>% 
  select(
    Q1, 
    starts_with("Q21_")
  ) %>% 
  #keep only numeric values
  mutate(across(starts_with("Q21_"), ~ gsub("[^0-9.-]+", "", .))) %>% 
  #change class to numeric for all columns that start with "Q21_"
  mutate_at(vars(starts_with("Q21_")), funs(as.numeric(as.character(.))))

#how many questions are asked
n <- (ncol(post_hope) - 1)
print(n)

#calculate the mean score per participant
post_hope$average <- round(rowMeans(post_hope[grep('^Q21_', names(post_hope))]), digits = 2)

print(post_hope)

post_hope_mean_avg <- mean(post_hope$average)
print(post_hope_mean_avg)
```



```{r follow_up_hope}
follow_up_hope <- follow_up_clean %>% 
  select(
    Q1, 
    starts_with("Q21_")
  ) %>% 
  #keep only numeric values
  mutate(across(starts_with("Q21_"), ~ gsub("[^0-9.-]+", "", .))) %>% 
  #change class to numeric for all columns that start with "Q21_"
  mutate_at(vars(starts_with("Q21_")), funs(as.numeric(as.character(.))))

#how many questions are asked
n <- (ncol(follow_up_hope) - 1)
print(n)

#calculate the mean score per participant
follow_up_hope$average <- round(rowMeans(follow_up_hope[grep('^Q21_', names(follow_up_hope))]), digits = 2)

print(follow_up_hope)

follow_up_hope_mean_avg <- mean(follow_up_hope$avg)
print(follow_up_hope_mean_avg)
```

```{r mean_average_summary}
# R program to illustrate 
# data frame from vector 

#how many surveys to summarize
Survey <- c("Pre-Survey", 
            "Post-Survey", 
            "Follow-Up") 

#how many participants per survey ?
Participants <- c(nrow(pre_hope), 
            nrow(post_hope),
            nrow(follow_up_hope)) 

#mean average score per week
MeanAverage <- c(pre_hope_mean_avg, 
                 NA, 
                 follow_up_hope_mean_avg)

Average <- c(NA, 
             post_hope$average,
             follow_up_hope$average)

#create the data frame 
class.df <- data.frame(Survey,
                      Participants,
                      MeanAverage,
                      Average) 
print(class.df)
```

##Empowerment

All Q23 questions 

H1i: Participants were hypothesized to report higher scores on the Individual-Community Related Empowerment Measure at post-test and follow-up than at pre-test. Descriptive analysis showed that at pre-test, the mean average score was ##, at post-test the mean average was ##, and at follow-up, the mean average score was ##, suggesting... 

```{r pre_empowerment}
pre_empowerment <- pre_survey_clean %>% 
  select(
    Q1, 
    starts_with("Q23_")
  ) %>% 
  #change class to numeric for all columns that start with "Q9_"
  mutate_at(vars(starts_with("Q23_")), funs(as.numeric(as.character(.))))

#how many questions are asked
n <- (ncol(pre_empowerment) - 1)
print(n)
if(n >= ncol(pre_empowerment))stop("Check n")

#calculate the mean score per participant
pre_empowerment$average <- round(rowMeans(pre_empowerment[grep('^Q23_', names(pre_empowerment))]), digits = 2)

print(pre_empowerment)

pre_empowerment_mean_avg <- round(mean(pre_empowerment$average), digits = 2)
print(pre_empowerment_mean_avg)
```

```{r post_empowerment}
post_empowerment <- post_survey_clean %>% 
  select(
    Q1, 
    starts_with("Q23_")
  ) %>% 
  #keep only numeric values
  mutate(across(starts_with("Q23_"), ~ gsub("[^0-9.-]+", "", .))) %>% 
  #change class to numeric for all columns that start with "Q23_"
  mutate_at(vars(starts_with("Q23_")), funs(as.numeric(as.character(.))))

#how many questions are asked
n <- (ncol(post_empowerment) - 1)
print(n)

#calculate the mean score per participant
post_empowerment$average <- round(rowMeans(post_empowerment[grep('^Q23_', names(post_empowerment))]), digits = 2)

print(post_empowerment)

post_empowerment_mean_avg <- mean(post_empowerment$average)
print(post_empowerment_mean_avg)
```

```{r follow_up_empowerment}
follow_up_empowerment <- follow_up_clean %>% 
  select(
    Q1, 
    starts_with("Q23_")
  ) %>% 
  #keep only numeric values
  mutate(across(starts_with("Q23_"), ~ gsub("[^0-9.-]+", "", .))) %>% 
  #change class to numeric for all columns that start with "Q23_"
  mutate_at(vars(starts_with("Q23_")), funs(as.numeric(as.character(.))))

#how many questions are asked
n <- (ncol(follow_up_empowerment) - 1)
print(n)

#calculate the mean score per participant
follow_up_empowerment$average <- round(rowMeans(follow_up_empowerment[grep('^Q23_', names(follow_up_empowerment))]), digits = 2)

print(follow_up_empowerment)

follow_up_empowerment_mean_avg <- mean(follow_up_empowerment$avg)
print(follow_up_empowerment_mean_avg)
```

```{r mean_average_summary}
# R program to illustrate 
# data frame from vector 

#how many surveys to summarize
Survey <- c("Pre-Survey", 
            "Post-Survey", 
            "Follow-Up") 

#how many participants per survey ?
Participants <- c(nrow(pre_empowerment), 
            nrow(post_empowerment),
            nrow(follow_up_empowerment)) 

#mean average score per week
MeanAverage <- c(pre_empowerment_mean_avg, 
                 NA, 
                 follow_up_empowerment_mean_avg)

Average <- c(NA, 
             post_empowerment$average,
             follow_up_empowerment$average)

#create the data frame 
class.df <- data.frame(Survey,
                      Participants,
                      MeanAverage,
                      Average) 
print(class.df)
```

